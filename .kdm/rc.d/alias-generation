# Functions: Alias generation

[[ "${_}" != "${0}" && "${SOURCE_VERBOSE}" == "true" ]] && output kv "Loaded" "${BASH_SOURCE[@]/$HOME\/\.kdm\//}"


# shellcheck disable=SC2139
_alias_linux_macos_setup() {
	# Bounce if not on GNU-converted macOS and not on Linux
	[[ -z "${MACOS_GNU}" && "${UNAME_KERNEL_NAME}" != "Linux" ]] && return

	# Declare vars as local
	local GREP_BASE LS_TIME_STYLE

	# grep config
	#     in a terminal : always enable/use color
	# NOT in a terminal : disable color
	GREP_BASE="grep --color=if-tty --no-messages"

	alias grep="${GREP_BASE}"
	alias egrep="${GREP_BASE} --extended-regexp" # -E
	alias fgrep="${GREP_BASE} --fixed-strings"   # -F
	alias igrep="${GREP_BASE} --ignore-case"     # -i
	alias rgrep="${GREP_BASE} --recursive"       # -r
	alias vgrep="${GREP_BASE} --invert-match"    # -v

	if hash zgrep; then
		alias zgrep="z${GREP_BASE}"
		alias zegrep="z${GREP_BASE} --extended-regexp" # -E
		alias zfgrep="z${GREP_BASE} --fixed-strings"   # -F
		alias zigrep="z${GREP_BASE} --ignore-case"     # -i
		alias zrgrep="z${GREP_BASE} --recursive"       # -r
		alias zvgrep="z${GREP_BASE} --invert-match"    # -v
	fi

	if hash xzgrep; then
		alias xzgrep="xz${GREP_BASE}"
		alias xzegrep="xz${GREP_BASE} --extended-regexp" # -E
		alias xzfgrep="xz${GREP_BASE} --fixed-strings"   # -F
		alias xzigrep="xz${GREP_BASE} --ignore-case"     # -i
		alias xzrgrep="xz${GREP_BASE} --recursive"       # -r
		alias xzvgrep="xz${GREP_BASE} --invert-match"    # -v
	fi

	alias cgrep='grep --no-messages --color=always' # Force enable color
	alias ncgrep='grep --no-messages --color=never'  # Force disable color


	# exa/ls config
	if hash exa; then
		export EXA_COLORS="da=38;5;255:uu=38;5;242:un=38;2;255;255;1"
		export EXA_ICON_SPACING="2"
		alias ls="exa --color=auto --color-scale --time-style long-iso --icons --group --group-directories-first 2> /dev/null"
	else
		LS_TIME_STYLE="+%Y-%m-%d %r"
		alias ls="ls --color=if-tty --group-directories-first --time-style='${LS_TIME_STYLE}' 2> /dev/null"
	fi


	# Sort by IP address octets
	# .. fought to find this one for a long, long time
	alias sort-ip='sort --field-separator="." --key="1,1g" --key="2,2g" --key="3,3g" --key="4,4g"'
}


# E-Z nmap commands
_alias_nmap() {
	# If it has nmap binary:
	# only open ports, grepable output, aggressive and verbose aliases
	hash nmap || return

	# nmap needs sudo if not root
	# First, add one for not aggressive one (but still verbose)
	if [[ "${UID}" != "0" ]]; then
		alias nmap='sudo nmap --open'
		# nmap-v for very verbose scan
		alias nmap-v='sudo nmap -vv --open'
		# nmap-a for aggressive scripting scan
		alias nmap-a='sudo nmap -vv -A --open'
		return
	fi

	# already root, no need for sudo
	alias nmap='nmap --open'
	# nmap-v for very verbose scan
	alias nmap-v='nmap -vv --open'
	# nmap-a for aggressive scripting scan
	alias nmap-a='nmap -vv -A --open'
}


# ping command tweaks
# shellcheck disable=SC2139
_alias_ping() {
	# Declare vars as local
	local PING

	# ping commands, if ping is present
	hash ping || return;

	# Get full path to binary
	PING=$(command -v ping)

	# ping-slow : normal (1.0 second interval)
	#      ping : fast   (0.5 second interval)
	# ping-fast : faster (0.1 second interval)
	alias ping="     ${PING} -i 0.5"
	alias ping-fast="${PING} -i 0.1"
	alias ping-slow="${PING} -i 1.0"
}

# ping6 command tweaks
# shellcheck disable=SC2139
_alias_ping6() {
	# Declare vars as local
	local ping6

	# ping6 commands, if ping6 is present
	hash ping6 || return;

	# Get full path to binary
	ping6=$(command -v ping6)

	# ping6-slow : normal (1.0 second interval)
	#      ping6 : fast   (0.5 second interval)
	# ping6-fast : faster (0.1 second interval)
	alias ping6="     ${ping6} -i 0.5"
	alias ping6-fast="${ping6} -i 0.1"
	alias ping6-slow="${ping6} -i 1.0"
}


# Pretty print HTML with tidy, indent: 2 spaces, sorted alphabetically, then colorize with pygmentize
_alias_pygmentize_html() {
	hash tidy || return
	alias html-format="dos2unix | sed -e '/^$/d' -e 's/^[ \\t]*//' -e 's/\\t/\\ /g' | tr '\\n' ' ' | sed -E 's/>(\\ {1,})</></g' | tidy 2> /dev/null | html-beautify -t false -E -T -U | pygmentize -l html -f terminal16m -O style=monokai"
	alias format-html='html-format'
}

# Pretty print JSON with jq, indent: 2 spaces (default), sorted alphabetically, then colorize with pygmentize
_alias_pygmentize_json() {
	hash jq || return
	alias json-format='dos2unix | jq -MS . 2> /dev/null | pygmentize -l json -f terminal16m -O style=monokai'
	alias format-json='json-format'
}

# Pretty print XML with xmllint, indent: 2 spaces (default), then colorize with pygmentize
_alias_pygmentize_xml() {
	hash xmllint || return
	alias xml-format='dos2unix | xmllint --format - 2> /dev/null | pygmentize -l xml -f terminal16m -O style=monokai'
	alias format-xml='xml-format'
}

# Prettyprint+colorize various formats, if supporting binaries are installed
# Get pygmentize with pip install pygments
_alias_pygmentize() {
	hash dos2unix   || return
	hash pygmentize || return

	_alias_pygmentize_html
	_alias_pygmentize_json
	_alias_pygmentize_xml
}


# Execute alias setup
_alias_linux_macos_setup


# vim: set filetype=sh ts=2 sw=2 tw=0 noet :
